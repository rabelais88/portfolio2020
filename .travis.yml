matrix:
  include:
    # --- api
    - language: go
      go:
        - "1.14"
      before_script:
        - docker-compose -f meili-docker-compose.yaml up
        - cd api
        - wget https://raw.githubusercontent.com/vishnubob/wait-for-it/master/wait-for-it.sh
        - chmod +x wait-for-it.sh
      script: ../wait-for-it.sh http://localhost:7700 -- go test -v ./...
      services:
        - docker
      # before_deploy:
      #   - cd api
      deploy:
        provider: script
        script: bash build-n-push.sh
        on:
          branch: master
    # --- front-www
    - langauge: node_js
      node_js:
        - "14.4.0"
      services:
        - docker
      before_script:
        - cd front-www
      script: echo "test is skipped for front-www"
      # before_deploy:
      #   - cd front-www
      deploy:
        provider: script
        script: bash build-n-push.sh
        on:
          branch: master
    # --- front-admin
    - langauge: node_js
      node_js:
        - "14.4.0"
      services:
        - docker
      before_script:
        - cd front-admin
      script: echo "test is skipped for front-admin"
      # before_deploy:
      #   - cd front-admin
      deploy:
        provider: script
        script: bash build-n-push.sh
        on:
          branch: master
    # multiple CIs are allowed
    # - language: ...